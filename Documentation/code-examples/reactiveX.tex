\begin{javacode}{4,12,15}
...
List<Product> existingProducts = new ArrayList<>();
	existingProducts.addAll(productDao.getProducts());
	Observable.from(existingProducts)
		.filter(p -> 
					p.getPrice() > 50 && 
					p.getStore().equals(STORE_A))
		.map(p -> new Product(
						p.getId(), 
						p.getPrice() * 1.10, 
						STORE_B))
		.subscribeOn(Schedulers.computation()) // do in background
		.doOnNext(p -> productDao.save(p))
		.doOnError(t -> handleError(t))
		.observeOn(Schedulers.uiThread()) // only as example: this scheduler doesn't exist
		.doOnCompleted(() -> updateUI())
		.subscribe();
	);
...
\end{javacode}