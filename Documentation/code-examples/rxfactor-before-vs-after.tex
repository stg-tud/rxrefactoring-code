\begin{figure}[h]
\begin{minipage}{0.48\textwidth}
\begin{sourcecode}
\begin{javacode}{2,7,13,19}
new AsyncTask<InputT, PublishT, ResultT>(){
	protected ResultT doInBackground(InputT... params){
		...
		for (...; ...; ...){
			PublishT p = longRunningOperation(...);
			...
			publish(p);
		}
		...
		return result;
	}
	
	protected onProgressUpdate(PublishT... values){
		...
		process(values);
		...
	}
	
	protected void onPostExecute(ResultT result){
		...
		finishTask(result);
		...
	}
}.execute();
\end{javacode}
\caption{Before Refactoring with \textsc{RxFactor}}
\label{code:rxfactor-before}
\end{sourcecode}
\end{minipage}\hspace{0.7cm}
\begin{minipage}{0.48\textwidth}
\begin{sourcecode}
\begin{javacode}{5,15,20,28}
private Subscriber<PublishT> getRxUpdateSubscriber() {
	return new Subscriber<PublishT[]>(){
		public void onCompleted(){ }		
		public void onError(Throwable t) { }		
		public void onNext(PublishT[] values){
			...
			process(values);
			...
		}
	}
}
...

Observable.fromCallable(new Callable<ResultT>() {
	public ResultT call() throws Exception{
		...
		for (...; ...; ...){
			Publish p = longRunningOperation(...);
			...
			getRxUpdateSubscriber().onNext(p);
		}
		...
		return result;
	}
}).subscribeOn(Schedulers.computation())
  .observeOn(AndroidSchedulers.mainThread())
  .doOnNext(new Action1<ResultT>(){
  	public void call(ResultT result) {
		...
		finishTask(result);
		...
  	}
}).subscribe();
\end{javacode}
\caption{After Refactoring with \textsc{RxFactor}}
\label{code:rxfactor-after}
\end{sourcecode}
\end{minipage}
\end{figure}